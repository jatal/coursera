---
title: "RegressionModels_CourseProject"
author: "Craig Rowley"
date: "December 19, 2014"
output: html_document
---

# Original Assignment text

##Context

You work for Motor Trend, a magazine about the automobile industry. Looking at a data set of a collection of cars, they are interested in exploring the relationship between a set of variables and miles per gallon (MPG) (outcome). They are particularly interested in the following two questions:

- Question 1 :: “Is an automatic or manual transmission better for MPG”
- Question 2 :: "Quantify the MPG difference between automatic and manual transmissions"

##Approach

Model Discovery and Selection)

- EDA and Univariate fits to discover any heteroskedasticity (HSK) issues
- Baseline "kitchen sink" model with Removal of HSK vars
- Simple Multivariate (n-Continuous + 1-Categorical)
- Select of maximum R^2

Answer questions)

- Follow hunger example for comparing two populations (manual and automatic transmission)




# Exploratory Data Analysis

##Initialize data set and display some standard EDA

Thoughts on Correlation:

- MPG is positively correlated with Manual transmission (am), Rear-axle ratio (drat), and an Inline engine (vs)
- MPG is negatively correlated with Vehicle weight (wt), Engine Displacement (disp), Cylinder count(cyl), and Horsepower (hp)
- MPG is lightly correlated with Gear count (gear), Carbuerator count (carb), and Quarter-mile time (qsec)
- Weight may have colinearity with  issues with Gear count, Transmission type, and Rear-axle ratio
- Engine Displacement may have correlation

Thoughts on Coefficients (grain of salt required - this is a kitchen sink model, after all) :

- Increased Weight, Carbuerator count, and Horsepower result in less MPG (matches intuition)
- Increased Displacement, Straight engine, More gears, Rear axle ratio, and Manual transmission result in higher MPG (matches intuition)
- The coefficients of Quarter-mile time and Cylinders do "not" match intuition as both should likely have negative impact on MPG

Thoughts on Colinearity :

- Variance inflation factors all reasonably high, indicating problems (we expect this for a kitchen sink model)
- Weight is correlated with most items on the list


```{r init_eda, cache=TRUE}
data(mtcars)
summary(mtcars)

#...Visually show correlation
library(corrgram)
corrgram(mtcars, order=TRUE, lower.panel=panel.shade, upper.panel=panel.pts, text.panel=panel.txt, main="")
#...Numerically show most correlated
sort( cor(mtcars)[,1] )
#...Baseline "kitchen sink" model 
fit <- lm(mpg ~ ., mtcars)
sort(fit$coefficients)
#...Investigate Colinearity
library(car)
sqrt( vif(fit) )
#...Use Correlation to investigate possible colinearity causes
sort(abs(cor(mtcars)["wt",]),decreasing=TRUE)
```

##Understand the data available to us

###mpg ::	Miles/(US) gallon

Our Dependent Variable.

###cyl :: Number of cylinders

Larger, more powerful vehicles typically have more cylinders.  More cylinders typically means more fuel-per-second consumed in modern cars (and more horsepower).  

Hypothesis:

- Number of cyliders will have negative correlation with MPG
- cyl will correlate with horsepower

```{r eda_cyl, cache=TRUE}
#...Look at some broad correlation
#...Convert cylinder to factor
mtcars$cyl <- factor(mtcars$cyl)
#...Model and output interesting EDA
fit <- lm(mpg ~ cyl -1, mtcars)
summary(fit)
par(mfrow=c(2,2))
plot(fit, which=c(1,2))
plot(mtcars$cyl,mtcars$mpg)


```

###disp :: Displacement (cu.in.)

Engine displacement is the volume swept by all the pistons inside the cylinders of a reciprocating engine in a single movement from top dead centre (TDC) to bottom dead centre (BDC). - Wikipedia

###hp :: Gross horsepower



###drat :: Rear axle ratio

\# of revolutions the Transmission will make to turn the rear axle (wheel) one time.
- Hypothesis: the more turns, the more potential friction, so less turns should have higher mpg
- Observations: Below shows that drat may be a good regressor as Residuals have approximately a zero mean, our qq-plot shows good relationship, our student suggests there may be an outlier or two, and not significant cooks distance.

Some Research:
“For typical combined city/highway and city (stop and go) driving), fuel economy is insensitive to final drive ratio,” says Clark.  Optional final drive ratios do have an impact on typical highway driving (steady state driving above 60 mph).”
“Speed, acceleration, loading and maintenance all impact fuel economy more than final-drive ratio,” says Clark. “For example, driving 10mph faster on the highway can reduce fuel economy by up to 4mpg.”

- http://www.hardworkingtrucks.com/understanding-axle-ratios/


```{r eda_drat, cache=TRUE}
fit <- lm(mpg ~ drat, mtcars)
par(mfrow=c(2,2))
plot(fit)
par(mfrow=c(1,1))
plot(mtcars$drat,mtcars$mpg)
abline(fit)
summary(fit)
```

###wt :: Weight (lb/1000)

Weight of vehicle expressed in units of 1k lbs

- Hypothesis: Newton's first law says that the force required to accelerate a vehicle is proportional to its mass, so a weight should have a negative correlation with mpg.
- Observations: Weight residual plot shows non-random U-shape, QQ plot indicates light tails
- Conclusion: a linear model based on weight alone is innappropriate

```{r eda_wt, cache=TRUE}
fit <- lm(mpg ~ wt, mtcars)
par(mfrow=c(2,2))
plot(fit)
```


###qsec :: 1/4 mile time



###vs :: V/S (0 = V-engine, 1 = Straight)

V or Straight-engine. 


###am :: Transmission (0 = automatic, 1 = manual)

Our required regressor for Question 2.

Research:
"In our tests, we've found that in some cars a manual transmission can improve gas mileage by a significant 2 to 5 mpg, compared with an automatic"
"Manual transmissions often can also improve acceleration, sometimes significantly. That can be a welcome benefit with a smaller engine"
" In a few cases, however, the latest automatic-transmission designs, including six-speed automatics, actually surpass their manual counterparts."

- Consumer Reports, October 2014: http://consumerreports.org/cro/2012/01/save-gas-and-money-with-a-manual-transmission/index.htm

Hypothesis: 

- Manual should help mpg
- Manual may have correlation with "qsec" if acceleration is better
- Manual may have correlation with "wt" 
- Automatic + High Gears may beat Manual for MPG, so their may be some interesting outliers.  It is also possible that there is an "interaction" between weight and gears that needs researched, since low weight and low gears may be interesting comparison

```{r eda_am, cache=TRUE}
#...Show the overall view
par(mfrow=c(1,1))
boxplot(mtcars$mpg~mtcars$am,names=c("Automatic","Manual"))

#...Look at average MPG for manual and automatic
aggregate(mtcars$mpg, list(mtcars$am), mean)

#...show the model performance
fit <- lm(mpg ~ drat + am, mtcars)
par(mfrow=c(2,2))
plot(fit)
summary(fit)

par(mfrow=c(1,1))
plot( mtcars$drat, mtcars$mpg )
abline(fit)


```


###gear :: Number of forward gears

Hypothesis: Based on research about higher gears, this may show interesting results for automatics with high number of gears

Findings:

- Automatic Transmissions with 4 gears have similar mean as manual transmission with 5 gears, so our hypothesis is not verified
- Manual Transmissions with similar gear count (4) have higher mean mpg

```{r eda_gear, cache=TRUE}
aggregate(mtcars$mpg, list(paste(mtcars$gear,'_',mtcars$am)), mean)
```



###carb :: Number of carburetors

```{r eda_carb, cache=TRUE}
fit <- lm(mpg ~ carb, mtcars)
par(mfrow=c(2,2))
plot(fit)
summary(fit)
```




```{r}

```




